---
import { Image } from 'astro:assets';

interface Props {
  projects: Array<{
    id: number;
    image: any;
    alt: string;
  }>;
  direction?: 'left' | 'right';
}

const { projects, direction = 'left' } = Astro.props;

const n = projects.length || 0;
let mixed: typeof projects = [];
if (n > 1) {
  const step = Math.floor(n / 2) || 1;
  for (let i = 0; i < n; i++) {
    mixed.push(projects[i]);
    mixed.push(projects[(i + step) % n]);
  }
} else {
  mixed = [...projects];
}

const duplicatedProjects = [...mixed, ...mixed];
---

<div class="marquee-container">
  <div class={`marquee-content marquee-${direction}`}>
    {duplicatedProjects.map((project, index) => (
      <div class="marquee-item">
        <div class="w-[280px] md:w-[320px] rounded-2xl overflow-hidden bg-white shadow-lg hover:shadow-xl transition-shadow duration-300">
          <Image
            src={project.image}
            alt={project.alt}
            class="w-full h-[200px] md:h-[240px] object-cover"
            loading="lazy"
            format="webp"
            width={320}
            height={240}
          />
        </div>
      </div>
    ))}
  </div>
</div>

<style is:global>
  .marquee-container {
    overflow: hidden;
    position: relative;
    width: 100%;
    padding: 0.5rem 0;
  }

  .marquee-content {
    display: flex;
    width: fit-content;
    will-change: transform;
  }

  .marquee-item {
    padding: 0 0.5rem;
    flex-shrink: 0;
  }

  .marquee-left {
    animation: scroll-left 40s linear infinite;
  }

  .marquee-right {
    animation: scroll-right 40s linear infinite;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-33.333%);
    }
  }

  @keyframes scroll-right {
    0% {
      transform: translateX(-33.333%);
    }
    100% {
      transform: translateX(0);
    }
  }

  .marquee-content:hover {
    animation-play-state: paused;
  }

  .marquee-content {
    backface-visibility: hidden;
    perspective: 1000px;
  }
</style>
